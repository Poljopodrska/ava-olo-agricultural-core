version: 1.0
runtime: python311
build:
  commands:
    pre-build:
      - echo "Installing dependencies for AVA OLO Agricultural Core with Authentication"
    build:
      - pip install -r requirements.txt
    post-build:
      - echo "Build completed - Authentication system ready"
run:
  runtime-version: 3.11
  command: uvicorn api_gateway_simple:app --host 0.0.0.0 --port 8080
  network:
    port: 8080
    env: PORT
  env:
    - name: DB_HOST
      value: "farmer-crm-production.cifgmm0mqg5q.us-east-1.rds.amazonaws.com"
    - name: DB_NAME
      value: "farmer_crm"
    - name: DB_USER
      value: "postgres"
    - name: DB_PASSWORD
      value: '2hpzvrg_xP~qNbz1[_NppSK$e*O1'
    - name: DB_PORT
      value: "5432"
    - name: DATABASE_URL
      value: "postgresql://postgres:2hpzvrg_xP~qNbz1[_NppSK$e*O1@farmer-crm-production.cifgmm0mqg5q.us-east-1.rds.amazonaws.com:5432/farmer_crm"
    - name: OPENAI_API_KEY
      value: "REPLACE_WITH_ACTUAL_OPENAI_API_KEY"
    - name: JWT_SECRET
      value: "constitutional-ava-olo-production-secret-key-2024"
    - name: JWT_EXPIRY_HOURS
      value: "24"
    - name: PERPLEXITY_API_KEY
      value: "REPLACE_WITH_ACTUAL_PERPLEXITY_API_KEY"
    - name: PINECONE_API_KEY
      value: "REPLACE_WITH_ACTUAL_PINECONE_API_KEY"
    - name: PINECONE_ENV
      value: "eu-west-1"
    - name: PINECONE_HOST
      value: "https://pivka-crm-eu-nwo7tyx.svc.apu-57e2-42f6.pinecone.io"
    - name: PINECONE_INDEX_NAME
      value: "pivka-crm-eu"
    - name: AWS_REGION
      value: "us-east-1"
    - name: APP_ENV
      value: "production"
    - name: ENABLE_CONSTITUTIONAL_CHECKS
      value: "true"
    # CAVA Configuration
    - name: CAVA_INTEGRATED_MODE
      value: "true"  # Enable CAVA integration
    - name: CAVA_DRY_RUN_MODE
      value: "true"  # Enable dry-run mode until databases are configured
    - name: DISABLE_CAVA
      value: "false"  # Enable CAVA for testing
    - name: CAVA_POSTGRESQL_SCHEMA
      value: "cava"
    - name: CAVA_REDIS_URL
      value: "redis://cava-redis-cluster.s2bgcr.cache.amazonaws.com:6379"
    - name: CAVA_NEO4J_URI
      value: "neo4j+s://3db86ac0.databases.neo4j.io:7687"
    - name: CAVA_NEO4J_USER
      value: "neo4j"
    - name: CAVA_NEO4J_PASSWORD
      value: "your-auradb-password"
    - name: CAVA_ENABLE_GRAPH
      value: "true"  # Enable Neo4j AuraDB
    - name: CAVA_ENABLE_VECTOR
      value: "true"  # Enable Pinecone vector intelligence
    - name: CAVA_ENABLE_MEMORY
      value: "true"