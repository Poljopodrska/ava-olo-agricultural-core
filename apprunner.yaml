version: 1.0
runtime: python3
build:
  commands:
    pre-build:
      - echo "ðŸš¨ CRITICAL CONSTITUTIONAL FIX - Commit 8a3408b - $(date) ðŸš¨"
      - echo "DEPLOYING LLM REGISTRATION FIX - CONSTITUTIONAL AMENDMENT #15"
      - rm -rf /tmp/cache/* || true
      - echo "Cache cleared - deploying critical fix"
    build:
      - pip install -r requirements.txt
      - echo "Dependencies installed - v3.4.2-constitutional-fix-8a3408b"
      - echo "CRITICAL FIX: Registration now uses LLM (Constitutional compliance)"
    post-build:
      - echo "Build completed - v3.4.2-constitutional-fix-8a3408b - $(date)"
      - echo "Critical fix deployed: Registration now uses OpenAI LLM"
run:
  runtime-version: latest
  command: python main.py
  network:
    port: 8080
    env: PORT
  env:
    - name: FORCE_REBUILD
      value: "8a3408b-1753620780"  # FORCE_REBUILD - Critical constitutional fix
    - name: DEPLOYMENT_ID
      value: "3.4.2-8a3408b-2025-07-26"
    - name: FORCE_FRESH_DEPLOY
      value: "TRUE"
    - name: COMMIT_HASH
      value: "8a3408b"
    - name: DB_HOST
      value: "your-db-host"
    - name: DB_NAME
      value: "farmer_crm"
    - name: DB_USER
      value: "postgres"
    - name: DB_PASSWORD
      value: "your-password"
    - name: DB_PORT
      value: "5432"
    - name: OPENAI_API_KEY
      value: "MUST_BE_SET_IN_AWS_CONSOLE"  # Set this in AWS App Runner console for security